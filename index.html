<!doctype html>
<html lang="ko" class="h-full">
 <head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>ë©”ëª¨ë¦¬ ê²Œì„</title>
  <script src="https://cdn.tailwindcss.com/3.4.17"></script>
  <script src="/_sdk/element_sdk.js"></script>
  <link href="https://fonts.googleapis.com/css2?family=Nunito:wght@600;800&amp;display=swap" rel="stylesheet">
  <style>
    * { font-family: 'Nunito', sans-serif; }
    
    .card-container { perspective: 1000px; }
    
    .card {
      position: relative;
      transform-style: preserve-3d;
      transition: transform 0.5s ease;
    }
    
    .card.flipped { transform: rotateY(180deg); }
    
    .card-face {
      position: absolute;
      width: 100%;
      height: 100%;
      backface-visibility: hidden;
      border-radius: 12px;
      display: flex;
      align-items: center;
      justify-content: center;
    }
    
    .card-back {
      background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
      box-shadow: 0 4px 15px rgba(102, 126, 234, 0.4);
    }
    
    .card-back::before {
      content: '?';
      font-size: clamp(1.5rem, 5vw, 2.5rem);
      color: rgba(255,255,255,0.3);
      font-weight: 800;
    }
    
    .card-front {
      background: linear-gradient(135deg, #ffecd2 0%, #fcb69f 100%);
      transform: rotateY(180deg);
      font-size: clamp(1.5rem, 5vw, 2.5rem);
      box-shadow: 0 4px 15px rgba(252, 182, 159, 0.4);
    }
    
    .card.matched { animation: matchPop 0.5s ease forwards; }
    
    @keyframes matchPop {
      0% { transform: rotateY(180deg) scale(1); }
      50% { transform: rotateY(180deg) scale(1.1); }
      100% { transform: rotateY(180deg) scale(0); opacity: 0; }
    }
    
    .card:hover:not(.flipped):not(.matched) { transform: scale(1.05); }
    
    @keyframes fadeIn {
      from { opacity: 0; transform: scale(0.95); }
      to { opacity: 1; transform: scale(1); }
    }
    
    .animate-fade-in { animation: fadeIn 0.5s ease; }
    
    .time-warning { animation: pulse 1s infinite; }
    
    @keyframes pulse {
      0%, 100% { opacity: 1; }
      50% { opacity: 0.7; }
    }

    @keyframes trophy-bounce {
      0%, 100% { transform: translateY(0); }
      50% { transform: translateY(-20px); }
    }

    .trophy-bounce { animation: trophy-bounce 0.6s ease-in-out; }

    @keyframes new-record-glow {
      0%, 100% { box-shadow: 0 0 20px rgba(255, 215, 0, 0.5); }
      50% { box-shadow: 0 0 40px rgba(255, 215, 0, 0.8); }
    }

    .new-record-glow { animation: new-record-glow 1.5s ease-in-out infinite; }

    .game-board-wrapper {
      display: flex;
      justify-content: center;
      align-items: flex-start;
    }

    /* âœ… ë°°ì¹˜ê°€ ê¸°ê¸°ë§ˆë‹¤ í”ë“¤ë¦¬ì§€ ì•Šê²Œ: ë³´ë“œëŠ” "grid"ë¡œ ê³ ì • */
    #game-board {
      display: grid !important;
      place-content: center;
      align-content: start;
      justify-content: center;
    }
  </style>
  <style>body { box-sizing: border-box; }</style>
  <script src="/_sdk/data_sdk.js" type="text/javascript"></script>
 </head>

 <body class="h-full">
  <div id="app" class="h-full w-full overflow-auto" style="background: linear-gradient(135deg, #1a1a2e 0%, #16213e 50%, #0f3460 100%);">
   <!-- Main Menu Screen -->
   <div id="main-menu" class="h-full flex flex-col items-center justify-center p-6 animate-fade-in">
    <div class="text-center mb-12">
     <h1 class="text-5xl md:text-6xl font-extrabold text-white mb-4 drop-shadow-lg">ğŸ§  ë©”ëª¨ë¦¬ ê²Œì„</h1>
     <p class="text-purple-300 text-lg">ë‚œì´ë„ë¥¼ ì„ íƒí•˜ì„¸ìš”!</p>
    </div>

    <div class="flex flex-col gap-4 w-full max-w-sm">
      <button onclick="startGame('easy')" class="group bg-gradient-to-r from-green-500 to-emerald-500 hover:from-green-600 hover:to-emerald-600 text-white font-bold py-4 px-8 rounded-2xl shadow-lg hover:shadow-xl transition-all duration-300 hover:scale-105 text-lg">
        <span class="block mb-1">ğŸ˜Š ì‰¬ì›€</span>
        <span class="text-sm font-normal opacity-90">16ì¥ (4Ã—4)</span>
        <span id="easy-record" class="text-xs font-normal opacity-75 mt-1"></span>
      </button>

      <button onclick="startGame('normal')" class="group bg-gradient-to-r from-blue-500 to-cyan-500 hover:from-blue-600 hover:to-cyan-600 text-white font-bold py-4 px-8 rounded-2xl shadow-lg hover:shadow-xl transition-all duration-300 hover:scale-105 text-lg">
        <span class="block mb-1">ğŸ® ë³´í†µ</span>
        <span class="text-sm font-normal opacity-90">20ì¥ (4Ã—5)</span>
        <span id="normal-record" class="text-xs font-normal opacity-75 mt-1"></span>
      </button>

      <button onclick="startGame('hard')" class="group bg-gradient-to-r from-pink-500 to-red-500 hover:from-pink-600 hover:to-red-600 text-white font-bold py-4 px-8 rounded-2xl shadow-lg hover:shadow-xl transition-all duration-300 hover:scale-105 text-lg">
        <span class="block mb-1">ğŸ”¥ ì–´ë ¤ì›€</span>
        <span class="text-sm font-normal opacity-90">30ì¥ (5Ã—6)</span>
        <span id="hard-record" class="text-xs font-normal opacity-75 mt-1"></span>
      </button>

      <button onclick="startGame('veryhard')" class="group bg-gradient-to-r from-yellow-500 to-orange-500 hover:from-yellow-600 hover:to-orange-600 text-white font-bold py-4 px-8 rounded-2xl shadow-lg hover:shadow-xl transition-all duration-300 hover:scale-105 text-lg">
        <span class="block mb-1">âš¡ ë² ë¦¬ í•˜ë“œ</span>
        <span class="text-sm font-normal opacity-90">40ì¥ (8Ã—5)</span>
        <span id="veryhard-record" class="text-xs font-normal opacity-75 mt-1"></span>
      </button>
    </div>
   </div>

   <!-- Game Screen -->
   <div id="game-screen" class="hidden h-full flex flex-col items-center justify-between p-4 md:p-6">
    <!-- Header -->
    <div class="text-center w-full flex-shrink-0">
     <h1 id="game-title" class="text-2xl md:text-3xl font-extrabold text-white mb-1 drop-shadow-lg">ğŸ§  ë©”ëª¨ë¦¬ ê²Œì„</h1>
     <p id="difficulty-text" class="text-purple-300 text-sm mb-3">ë‚œì´ë„</p>
    </div>

    <!-- Stats -->
    <div id="stats-container" class="flex gap-3 md:gap-4 w-full justify-center flex-wrap flex-shrink-0">
     <div class="bg-white/10 backdrop-blur-sm rounded-xl px-3 md:px-4 py-2 text-center">
      <div class="text-lg md:text-xl font-bold text-yellow-400" id="moves">0</div>
      <div class="text-xs text-purple-200">ì‹œë„ íšŸìˆ˜</div>
     </div>
     <div class="bg-white/10 backdrop-blur-sm rounded-xl px-3 md:px-4 py-2 text-center">
      <div class="text-lg md:text-xl font-bold text-green-400" id="matches">0</div>
      <div class="text-xs text-purple-200">ë§¤ì¹­ ì„±ê³µ</div>
     </div>
     <div id="timer-container" class="bg-white/10 backdrop-blur-sm rounded-xl px-3 md:px-4 py-2 text-center">
      <div id="timer" class="text-lg md:text-xl font-bold text-cyan-400">3:00</div>
      <div class="text-xs text-purple-200">ë‚¨ì€ ì‹œê°„</div>
     </div>
    </div>

    <!-- Game Board Wrapper -->
    <div class="game-board-wrapper flex-grow flex items-start justify-center w-full overflow-hidden pt-4">
     <div id="game-board" class="gap-2 md:gap-3">
     </div>
    </div>

    <!-- Buttons -->
    <div class="flex gap-4 justify-center mt-4 flex-shrink-0">
      <button id="restart-btn" onclick="restartGame()" class="bg-gradient-to-r from-green-500 to-emerald-600 hover:from-green-600 hover:to-emerald-700 text-white font-bold py-3 px-6 rounded-full shadow-lg hover:shadow-xl transition-all duration-300 hover:scale-105"> ğŸ”„ ë‹¤ì‹œ ì‹œì‘ </button>
      <button onclick="goToMenu()" class="bg-gradient-to-r from-gray-600 to-gray-700 hover:from-gray-700 hover:to-gray-800 text-white font-bold py-3 px-6 rounded-full shadow-lg hover:shadow-xl transition-all duration-300 hover:scale-105"> ğŸ  ë©”ë‰´ </button>
    </div>
   </div>

   <!-- Game Over Modal -->
   <div id="game-over-modal" class="hidden fixed inset-0 bg-black/70 backdrop-blur-sm flex items-center justify-center z-50 p-4">
    <div id="modal-content" class="bg-gradient-to-br from-purple-600 to-pink-500 rounded-3xl p-6 md:p-8 text-center shadow-2xl max-w-sm w-full">
     <div id="modal-icon" class="text-5xl md:text-6xl mb-4">ğŸ˜¢</div>
     <h2 id="modal-title" class="text-2xl md:text-3xl font-extrabold text-white mb-2">ì‹œê°„ ì´ˆê³¼!</h2>
     <p id="modal-desc" class="text-purple-100 mb-4">ì•„ì‰¬ì›Œìš”. ë‹¤ì‹œ ë„ì „í•´ ë³´ì„¸ìš”!</p>
     <div class="bg-white/20 rounded-xl p-4 mb-6">
      <div class="text-white"><span class="block text-sm opacity-80">ì‹œë„ íšŸìˆ˜</span> <span id="final-moves" class="text-2xl font-bold">0</span></div>
      <div class="text-white mt-3"><span class="block text-sm opacity-80">ë§¤ì¹­ ì„±ê³µ</span> <span id="final-matches" class="text-2xl font-bold">0</span></div>
     </div>
     <div class="flex gap-3 justify-center flex-col md:flex-row">
      <button onclick="closeModal(); restartGame();" class="bg-white text-purple-600 font-bold py-3 px-6 rounded-full hover:bg-purple-100 transition-all duration-300 flex-1"> ë‹¤ì‹œ ë„ì „! ğŸš€ </button>
      <button onclick="closeModal(); goToMenu();" class="bg-purple-800 text-white font-bold py-3 px-6 rounded-full hover:bg-purple-900 transition-all duration-300 flex-1"> ë©”ë‰´ </button>
     </div>
    </div>
   </div>

   <!-- Win Modal -->
   <div id="win-modal" class="hidden fixed inset-0 bg-black/70 backdrop-blur-sm flex items-center justify-center z-50 p-4">
    <div id="win-modal-content" class="bg-gradient-to-br from-purple-600 to-pink-500 rounded-3xl p-6 md:p-8 text-center shadow-2xl max-w-sm w-full">
     <div id="trophy-icon" class="text-5xl md:text-6xl mb-4 trophy-bounce">ğŸ‰</div>
     <h2 id="win-title" class="text-2xl md:text-3xl font-extrabold text-white mb-2">ì¶•í•˜í•´ìš”!</h2>
     <p id="win-desc" class="text-purple-100 mb-4">ëª¨ë“  ì¹´ë“œë¥¼ ì°¾ì•˜ì–´ìš”!</p>

     <!-- New Record Badge -->
     <div id="new-record-badge" class="hidden mb-4">
      <div class="bg-gradient-to-r from-yellow-300 to-yellow-100 text-yellow-900 rounded-full px-4 py-2 font-bold text-lg inline-block new-record-glow">
       ğŸ† NEW RECORD! ğŸ†
      </div>
     </div>

     <div class="bg-white/20 rounded-xl p-4 mb-6">
      <div class="grid grid-cols-2 gap-4">
       <div class="text-white"><span class="block text-sm opacity-80">ì‹œë„ íšŸìˆ˜</span> <span id="win-final-moves" class="text-2xl font-bold">0</span></div>
       <div class="text-white"><span class="block text-sm opacity-80">ë§¤ì¹­ ì„±ê³µ</span> <span id="win-final-matches" class="text-2xl font-bold">0</span></div>

       <div class="text-white col-span-2 pt-2 border-t border-white/30">
        <span class="block text-sm opacity-80 mb-1">â±ï¸ ë‚´ ê¸°ë¡ (ì ìˆ˜)</span>
        <span id="my-score" class="text-2xl font-bold text-yellow-300">0ì´ˆ</span>
       </div>

       <div class="text-white col-span-2">
        <span class="block text-sm opacity-80 mb-1">â­ ìµœê³ ê¸°ë¡</span>
        <span id="best-score" class="text-2xl font-bold text-cyan-300">0ì´ˆ</span>
       </div>
      </div>
     </div>

     <div class="flex gap-3 justify-center flex-col md:flex-row">
      <button onclick="closeWinModal(); restartGame();" class="bg-white text-purple-600 font-bold py-3 px-6 rounded-full hover:bg-purple-100 transition-all duration-300 flex-1"> ë‹¤ì‹œ ë„ì „! ğŸš€ </button>
      <button onclick="closeWinModal(); goToMenu();" class="bg-purple-800 text-white font-bold py-3 px-6 rounded-full hover:bg-purple-900 transition-all duration-300 flex-1"> ë©”ë‰´ </button>
     </div>
    </div>
   </div>
  </div>

  <script>
    // Game state
    let cards = [];
    let flippedCards = [];
    let matchedPairs = 0;
    let moves = 0;
    let gameStarted = false;
    let timerInterval = null;
    let seconds = 0;
    let isLocked = false;
    let currentDifficulty = null;
    let timeLimit = 180;

    // âœ… ì´ëª¨ì§€ 20ìŒìš©(ì¤‘ë³µ ì œê±°/ì •ë¦¬)
    const allEmojis = ['ğŸ¦Š','ğŸ¼','ğŸ¦','ğŸ¸','ğŸ¦‹','ğŸŒ¸','â­','ğŸŒˆ','ğŸ','ğŸˆ','ğŸ¸','ğŸ®','ğŸš€','ğŸ°','âš½','ğŸ¨','ğŸ¦’','ğŸ¦“','ğŸ·','ğŸµ'];

    // Difficulty settings (âœ… cardSize ì‚­ì œ: í™”ë©´ ê³„ì‚°ìœ¼ë¡œ ìë™)
    const difficultySettings = {
      easy:    { pairs: 8,  cols: 4, rows: 4, timeLimit: 180, text: 'ğŸ˜Š ì‰¬ì›€' },
      normal:  { pairs: 10, cols: 5, rows: 4, timeLimit: 180, text: 'ğŸ® ë³´í†µ' },
      hard:    { pairs: 15, cols: 6, rows: 5, timeLimit: 180, text: 'ğŸ”¥ ì–´ë ¤ì›€' },
      veryhard:{ pairs: 20, cols: 8, rows: 5, timeLimit: 180, text: 'âš¡ ë² ë¦¬ í•˜ë“œ' }
    };

    // Default config
    const defaultConfig = {
      game_title: 'ğŸ§  ë©”ëª¨ë¦¬ ê²Œì„',
      time_limit: '180'
    };

    // Sound effect function
    function playMatchSound() {
      const audioContext = new (window.AudioContext || window.webkitAudioContext)();
      const oscillator = audioContext.createOscillator();
      const gainNode = audioContext.createGain();

      oscillator.connect(gainNode);
      gainNode.connect(audioContext.destination);

      oscillator.frequency.value = 800;
      oscillator.type = 'sine';

      gainNode.gain.setValueAtTime(0.3, audioContext.currentTime);
      gainNode.gain.exponentialRampToValueAtTime(0.01, audioContext.currentTime + 0.2);

      oscillator.start(audioContext.currentTime);
      oscillator.stop(audioContext.currentTime + 0.2);
    }

    // Record storage
    function saveRecord(difficulty, timeScore) {
      const records = JSON.parse(localStorage.getItem('memoryGameRecords') || '{}');
      if (!records[difficulty] || timeScore < records[difficulty]) {
        records[difficulty] = timeScore;
        localStorage.setItem('memoryGameRecords', JSON.stringify(records));
        return true; // New record
      }
      return false;
    }

    function getRecord(difficulty) {
      const records = JSON.parse(localStorage.getItem('memoryGameRecords') || '{}');
      return records[difficulty] ?? null;
    }

    function formatTimeScore(seconds) {
      const mins = Math.floor(seconds / 60);
      const secs = seconds % 60;
      return `${mins}:${secs.toString().padStart(2, '0')}`;
    }

    function updateRecordDisplay() {
      document.getElementById('easy-record').textContent = getRecord('easy') ? `ìµœê³ ê¸°ë¡: ${formatTimeScore(getRecord('easy'))}` : 'ì•„ì§ ê¸°ë¡ì´ ì—†ì–´ìš”';
      document.getElementById('normal-record').textContent = getRecord('normal') ? `ìµœê³ ê¸°ë¡: ${formatTimeScore(getRecord('normal'))}` : 'ì•„ì§ ê¸°ë¡ì´ ì—†ì–´ìš”';
      document.getElementById('hard-record').textContent = getRecord('hard') ? `ìµœê³ ê¸°ë¡: ${formatTimeScore(getRecord('hard'))}` : 'ì•„ì§ ê¸°ë¡ì´ ì—†ì–´ìš”';
      document.getElementById('veryhard-record').textContent = getRecord('veryhard') ? `ìµœê³ ê¸°ë¡: ${formatTimeScore(getRecord('veryhard'))}` : 'ì•„ì§ ê¸°ë¡ì´ ì—†ì–´ìš”';
    }

    // Initialize game
    function initGame() {
      const settings = difficultySettings[currentDifficulty];
      const emojisUsed = allEmojis.slice(0, settings.pairs);

      cards = [...emojisUsed, ...emojisUsed]
        .sort(() => Math.random() - 0.5)
        .map((emoji, index) => ({
          id: index,
          emoji,
          isFlipped: false,
          isMatched: false
        }));

      flippedCards = [];
      matchedPairs = 0;
      moves = 0;
      seconds = 0;
      gameStarted = false;
      isLocked = false;

      if (timerInterval) {
        clearInterval(timerInterval);
        timerInterval = null;
      }

      updateStats();
      renderBoard();
    }

    // âœ… í•µì‹¬: ì–´ë–¤ ê¸°ê¸°ë“  "í•œ í™”ë©´ì— ê½‰" + "ë°°ì¹˜ ê³ ì •"
    function renderBoard() {
      const board = document.getElementById('game-board');
      const wrapper = document.querySelector('.game-board-wrapper');
      const settings = difficultySettings[currentDifficulty];

      // ë°°ì¹˜ ê³ ì •(Grid)
      const cols = settings.cols;
      const rows = settings.rows;
      board.style.gridTemplateColumns = `repeat(${cols}, 1fr)`;

      // gap ê³„ì‚° (Tailwind gap-2 / md:gap-3)
      const gap = window.innerWidth >= 768 ? 12 : 8; // px
      board.style.gap = gap + 'px';

      // wrapper ì‹¤ì œ ê°€ìš© ì˜ì—­ ê¸°ë°˜ìœ¼ë¡œ ì¹´ë“œ í¬ê¸° ê³„ì‚°
      const w = wrapper.clientWidth;
      const h = wrapper.clientHeight;

      const sizeByWidth = (w - gap * (cols - 1)) / cols;
      const sizeByHeight = (h - gap * (rows - 1)) / rows;

      // ë„ˆë¬´ ì‘ì•„ì§€ëŠ” ê²ƒ ë°©ì§€(ê°€ë…ì„±)
      const minSize = 42;
      const cardSize = Math.max(minSize, Math.floor(Math.min(sizeByWidth, sizeByHeight)));

      board.innerHTML = '';

      cards.forEach((card, index) => {
        const cardElement = document.createElement('div');
        cardElement.className = 'card-container cursor-pointer';
        cardElement.style.width = cardSize + 'px';
        cardElement.style.height = cardSize + 'px';

        cardElement.innerHTML = `
          <div class="card w-full h-full ${card.isFlipped || card.isMatched ? 'flipped' : ''} ${card.isMatched ? 'matched' : ''}" data-index="${index}">
            <div class="card-face card-back"></div>
            <div class="card-face card-front">${card.emoji}</div>
          </div>
        `;

        cardElement.onclick = () => flipCard(index);
        board.appendChild(cardElement);
      });
    }

    // âœ… íšŒì „/ë¦¬ì‚¬ì´ì¦ˆ ì‹œì—ë„ â€œê½‰ ì±„ì›€â€ ìœ ì§€
    window.addEventListener('resize', () => {
      if (currentDifficulty) renderBoard();
    });

    function flipCard(index) {
      if (isLocked) return;
      if (cards[index].isFlipped || cards[index].isMatched) return;
      if (flippedCards.length >= 2) return;

      if (!gameStarted) {
        gameStarted = true;
        startTimer();
      }

      cards[index].isFlipped = true;
      flippedCards.push(index);

      const cardElement = document.querySelector(`[data-index="${index}"]`);
      cardElement.classList.add('flipped');

      if (flippedCards.length === 2) {
        moves++;
        updateStats();
        checkMatch();
      }
    }

    function checkMatch() {
      const [first, second] = flippedCards;

      if (cards[first].emoji === cards[second].emoji) {
        playMatchSound();
        cards[first].isMatched = true;
        cards[second].isMatched = true;
        matchedPairs++;

        setTimeout(() => {
          const firstCard = document.querySelector(`[data-index="${first}"]`);
          const secondCard = document.querySelector(`[data-index="${second}"]`);
          firstCard.classList.add('matched');
          secondCard.classList.add('matched');

          flippedCards = [];
          updateStats();

          const settings = difficultySettings[currentDifficulty];
          if (matchedPairs === settings.pairs) {
            setTimeout(showWinModal, 600);
          }
        }, 300);

      } else {
        isLocked = true;
        setTimeout(() => {
          cards[first].isFlipped = false;
          cards[second].isFlipped = false;

          const firstCard = document.querySelector(`[data-index="${first}"]`);
          const secondCard = document.querySelector(`[data-index="${second}"]`);
          firstCard.classList.remove('flipped');
          secondCard.classList.remove('flipped');

          flippedCards = [];
          isLocked = false;
        }, 1000);
      }
    }

    function startTimer() {
      timerInterval = setInterval(() => {
        seconds++;

        if (seconds >= timeLimit) {
          clearInterval(timerInterval);
          timerInterval = null;
          showGameOverModal();
          return;
        }

        updateStats();
      }, 1000);
    }

    function formatTime(totalSeconds) {
      const mins = Math.floor(totalSeconds / 60);
      const secs = totalSeconds % 60;
      return `${mins}:${secs.toString().padStart(2, '0')}`;
    }

    function getTimeRemaining() {
      const remaining = timeLimit - seconds;
      return remaining < 0 ? 0 : remaining;
    }

    function updateStats() {
      document.getElementById('moves').textContent = moves;
      document.getElementById('matches').textContent = matchedPairs;

      const remaining = getTimeRemaining();
      document.getElementById('timer').textContent = formatTime(remaining);

      const timerContainer = document.getElementById('timer-container');
      if (remaining <= 30 && remaining > 0) timerContainer.classList.add('time-warning');
      else timerContainer.classList.remove('time-warning');
    }

    function showWinModal() {
      if (timerInterval) {
        clearInterval(timerInterval);
        timerInterval = null;
      }

      const timeScore = seconds;
      const isNewRecord = saveRecord(currentDifficulty, timeScore);
      const bestRecord = getRecord(currentDifficulty);

      document.getElementById('trophy-icon').textContent = 'ğŸ‰';
      document.getElementById('win-title').textContent = 'ì¶•í•˜í•´ìš”!';
      document.getElementById('win-desc').textContent = 'ëª¨ë“  ì¹´ë“œë¥¼ ì°¾ì•˜ì–´ìš”!';
      document.getElementById('win-final-moves').textContent = moves;
      document.getElementById('win-final-matches').textContent = matchedPairs;
      document.getElementById('my-score').textContent = formatTimeScore(timeScore);
      document.getElementById('best-score').textContent = formatTimeScore(bestRecord);

      if (isNewRecord) {
        document.getElementById('new-record-badge').classList.remove('hidden');
        document.getElementById('trophy-icon').textContent = 'ğŸ†';
      } else {
        document.getElementById('new-record-badge').classList.add('hidden');
      }

      document.getElementById('win-modal').classList.remove('hidden');
      updateRecordDisplay();
    }

    function showGameOverModal() {
      document.getElementById('modal-icon').textContent = 'ğŸ˜¢';
      document.getElementById('modal-title').textContent = 'ì‹œê°„ ì´ˆê³¼!';
      document.getElementById('modal-desc').textContent = 'ì•„ì‰¬ì›Œìš”. ë‹¤ì‹œ ë„ì „í•´ ë³´ì„¸ìš”!';
      document.getElementById('final-moves').textContent = moves;
      document.getElementById('final-matches').textContent = matchedPairs;
      document.getElementById('game-over-modal').classList.remove('hidden');
    }

    function closeModal() {
      document.getElementById('game-over-modal').classList.add('hidden');
    }

    function closeWinModal() {
      document.getElementById('win-modal').classList.add('hidden');
    }

    function startGame(difficulty) {
      currentDifficulty = difficulty;
      const settings = difficultySettings[difficulty];
      document.getElementById('difficulty-text').textContent = settings.text;

      const timeLimitConfig = parseInt(window.elementSdk?.config?.time_limit || defaultConfig.time_limit);
      timeLimit = timeLimitConfig || 180;

      document.getElementById('main-menu').classList.add('hidden');
      document.getElementById('game-screen').classList.remove('hidden');

      initGame();

      // âœ… ì²« ë Œë” í›„ wrapper í¬ê¸° ì•ˆì •í™”(ë ˆì´ì•„ì›ƒ ì¡íŒ ë‹¤ìŒ ë‹¤ì‹œ ê³„ì‚°)
      requestAnimationFrame(() => renderBoard());
      setTimeout(() => { if (currentDifficulty) renderBoard(); }, 60);
    }

    function restartGame() {
      closeModal();
      closeWinModal();
      initGame();
      requestAnimationFrame(() => renderBoard());
    }

    function goToMenu() {
      if (timerInterval) {
        clearInterval(timerInterval);
        timerInterval = null;
      }
      document.getElementById('game-screen').classList.add('hidden');
      document.getElementById('main-menu').classList.remove('hidden');
      closeModal();
      closeWinModal();
      updateRecordDisplay();
    }

    async function onConfigChange(config) {
      const title = config.game_title || defaultConfig.game_title;
      document.getElementById('game-title').textContent = title;
    }

    if (window.elementSdk) {
      window.elementSdk.init({
        defaultConfig: defaultConfig,
        onConfigChange: onConfigChange,
        mapToCapabilities: (config) => ({
          recolorables: [],
          borderables: [],
          fontEditable: undefined,
          fontSizeable: undefined
        }),
        mapToEditPanelValues: (config) => new Map([
          ['game_title', config.game_title || defaultConfig.game_title],
          ['time_limit', config.time_limit || defaultConfig.time_limit]
        ])
      });
    }

    updateRecordDisplay();
  </script>

  <script>(function(){function c(){var b=a.contentDocument||a.contentWindow.document;if(b){var d=b.createElement('script');d.innerHTML="window.__CF$cv$params={r:'9cdd40be96bac44e',t:'MTc3MTA3OTMxNi4wMDAwMDA='};var a=document.createElement('script');a.nonce='';a.src='/cdn-cgi/challenge-platform/scripts/jsd/main.js';document.getElementsByTagName('head')[0].appendChild(a);";b.getElementsByTagName('head')[0].appendChild(d)}}if(document.body){var a=document.createElement('iframe');a.height=1;a.width=1;a.style.position='absolute';a.style.top=0;a.style.left=0;a.style.border='none';a.style.visibility='hidden';document.body.appendChild(a);if('loading'!==document.readyState)c();else if(window.addEventListener)document.addEventListener('DOMContentLoaded',c);else{var e=document.onreadystatechange||function(){};document.onreadystatechange=function(b){e(b);'loading'!==document.readyState&&(document.onreadystatechange=e,c())}}}})();</script>
 </body>
</html>
