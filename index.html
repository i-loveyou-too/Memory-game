<!doctype html>
<html lang="ko" class="h-full">
 <head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>ë©”ëª¨ë¦¬ ê²Œì„</title>
  <script src="https://cdn.tailwindcss.com/3.4.17"></script>
  <script src="/_sdk/element_sdk.js"></script>
  <link href="https://fonts.googleapis.com/css2?family=Nunito:wght@600;800&amp;display=swap" rel="stylesheet">
  <style>
    * { font-family: 'Nunito', sans-serif; }
    
    .card-container {
      perspective: 1000px;
    }
    
    .card {
      position: relative;
      transform-style: preserve-3d;
      transition: transform 0.5s ease;
    }
    
    .card.flipped {
      transform: rotateY(180deg);
    }
    
    .card-face {
      position: absolute;
      width: 100%;
      height: 100%;
      backface-visibility: hidden;
      border-radius: 12px;
      display: flex;
      align-items: center;
      justify-content: center;
    }
    
    .card-back {
      background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
      box-shadow: 0 4px 15px rgba(102, 126, 234, 0.4);
    }
    
    .card-back::before {
      content: '?';
      font-size: 2.5rem;
      color: rgba(255,255,255,0.3);
      font-weight: 800;
    }
    
    .card-front {
      background: linear-gradient(135deg, #ffecd2 0%, #fcb69f 100%);
      transform: rotateY(180deg);
      font-size: 2.5rem;
      box-shadow: 0 4px 15px rgba(252, 182, 159, 0.4);
    }
    
    .card.matched {
      animation: matchPop 0.5s ease forwards;
    }
    
    @keyframes matchPop {
      0% { transform: rotateY(180deg) scale(1); }
      50% { transform: rotateY(180deg) scale(1.1); }
      100% { transform: rotateY(180deg) scale(0); opacity: 0; }
    }
    
    .card:hover:not(.flipped):not(.matched) {
      transform: scale(1.05);
    }
    
    @keyframes fadeIn {
      from { opacity: 0; transform: scale(0.95); }
      to { opacity: 1; transform: scale(1); }
    }
    
    .animate-fade-in {
      animation: fadeIn 0.5s ease;
    }
    
    .time-warning {
      animation: pulse 1s infinite;
    }
    
    @keyframes pulse {
      0%, 100% { opacity: 1; }
      50% { opacity: 0.7; }
    }
  </style>
  <style>body { box-sizing: border-box; }</style>
  <script src="/_sdk/data_sdk.js" type="text/javascript"></script>
 </head>
 <body class="h-full">
  <div id="app" class="h-full w-full overflow-auto" style="background: linear-gradient(135deg, #1a1a2e 0%, #16213e 50%, #0f3460 100%);"><!-- Main Menu Screen -->
   <div id="main-menu" class="h-full flex flex-col items-center justify-center p-6 animate-fade-in">
    <div class="text-center mb-12">
     <h1 class="text-5xl md:text-6xl font-extrabold text-white mb-4 drop-shadow-lg">ğŸ§  ë©”ëª¨ë¦¬ ê²Œì„</h1>
     <p class="text-purple-300 text-lg">ë‚œì´ë„ë¥¼ ì„ íƒí•˜ì„¸ìš”!</p>
    </div>
    <div class="flex flex-col gap-4 w-full max-w-sm"><button onclick="startGame('easy')" class="group bg-gradient-to-r from-green-500 to-emerald-500 hover:from-green-600 hover:to-emerald-600 text-white font-bold py-4 px-8 rounded-2xl shadow-lg hover:shadow-xl transition-all duration-300 hover:scale-105 text-lg"> <span class="block mb-1">ğŸ˜Š ì‰¬ì›€</span> <span class="text-sm font-normal opacity-90">16ì¥ (4Ã—4)</span> </button> <button onclick="startGame('normal')" class="group bg-gradient-to-r from-blue-500 to-cyan-500 hover:from-blue-600 hover:to-cyan-600 text-white font-bold py-4 px-8 rounded-2xl shadow-lg hover:shadow-xl transition-all duration-300 hover:scale-105 text-lg"> <span class="block mb-1">ğŸ® ë³´í†µ</span> <span class="text-sm font-normal opacity-90">20ì¥ (4Ã—5)</span> </button> <button onclick="startGame('hard')" class="group bg-gradient-to-r from-pink-500 to-red-500 hover:from-pink-600 hover:to-red-600 text-white font-bold py-4 px-8 rounded-2xl shadow-lg hover:shadow-xl transition-all duration-300 hover:scale-105 text-lg"> <span class="block mb-1">ğŸ”¥ ì–´ë ¤ì›€</span> <span class="text-sm font-normal opacity-90">30ì¥ (5Ã—6)</span> </button>
    </div>
   </div><!-- Game Screen -->
   <div id="game-screen" class="hidden h-full flex flex-col items-center justify-start p-4 md:p-6 overflow-y-auto"><!-- Header -->
    <div class="text-center mb-4 w-full">
     <h1 id="game-title" class="text-3xl md:text-4xl font-extrabold text-white mb-1 drop-shadow-lg">ğŸ§  ë©”ëª¨ë¦¬ ê²Œì„</h1>
     <p id="difficulty-text" class="text-purple-300 text-sm mb-3">ë‚œì´ë„</p>
    </div><!-- Stats -->
    <div id="stats-container" class="flex gap-4 mb-6 w-full justify-center flex-wrap">
     <div class="bg-white/10 backdrop-blur-sm rounded-xl px-4 py-2 text-center">
      <div class="text-xl md:text-2xl font-bold text-yellow-400" id="moves">
       0
      </div>
      <div class="text-xs text-purple-200">
       ì‹œë„ íšŸìˆ˜
      </div>
     </div>
     <div class="bg-white/10 backdrop-blur-sm rounded-xl px-4 py-2 text-center">
      <div class="text-xl md:text-2xl font-bold text-green-400" id="matches">
       0
      </div>
      <div class="text-xs text-purple-200">
       ë§¤ì¹­ ì„±ê³µ
      </div>
     </div>
     <div id="timer-container" class="bg-white/10 backdrop-blur-sm rounded-xl px-4 py-2 text-center">
      <div id="timer" class="text-xl md:text-2xl font-bold text-cyan-400">
       3:00
      </div>
      <div class="text-xs text-purple-200">
       ë‚¨ì€ ì‹œê°„
      </div>
     </div>
    </div><!-- Game Board -->
    <div id="game-board" class="gap-3 max-w-full mx-auto mb-6 flex justify-center flex-wrap"><!-- Cards will be generated here -->
    </div><!-- Buttons -->
    <div class="flex gap-4 justify-center mt-4"><button id="restart-btn" onclick="restartGame()" class="bg-gradient-to-r from-green-500 to-emerald-600 hover:from-green-600 hover:to-emerald-700 text-white font-bold py-3 px-6 rounded-full shadow-lg hover:shadow-xl transition-all duration-300 hover:scale-105"> ğŸ”„ ë‹¤ì‹œ ì‹œì‘ </button> <button onclick="goToMenu()" class="bg-gradient-to-r from-gray-600 to-gray-700 hover:from-gray-700 hover:to-gray-800 text-white font-bold py-3 px-6 rounded-full shadow-lg hover:shadow-xl transition-all duration-300 hover:scale-105"> ğŸ  ë©”ë‰´ </button>
    </div>
   </div><!-- Game Over Modal -->
   <div id="game-over-modal" class="hidden fixed inset-0 bg-black/70 backdrop-blur-sm flex items-center justify-center z-50">
    <div id="modal-content" class="bg-gradient-to-br from-purple-600 to-pink-500 rounded-3xl p-8 text-center shadow-2xl max-w-sm mx-4">
     <div id="modal-icon" class="text-6xl mb-4">
      ğŸ˜¢
     </div>
     <h2 id="modal-title" class="text-3xl font-extrabold text-white mb-2">ì‹œê°„ ì´ˆê³¼!</h2>
     <p id="modal-desc" class="text-purple-100 mb-4">ì•„ì‰¬ì›Œìš”. ë‹¤ì‹œ ë„ì „í•´ ë³´ì„¸ìš”!</p>
     <div class="bg-white/20 rounded-xl p-4 mb-6">
      <div class="text-white"><span class="block text-sm opacity-80">ì‹œë„ íšŸìˆ˜</span> <span id="final-moves" class="text-2xl font-bold">0</span>
      </div>
      <div class="text-white mt-2"><span class="block text-sm opacity-80">ë§¤ì¹­ ì„±ê³µ</span> <span id="final-matches" class="text-2xl font-bold">0</span>
      </div>
     </div>
     <div class="flex gap-3 justify-center"><button onclick="closeModal(); restartGame();" class="bg-white text-purple-600 font-bold py-3 px-6 rounded-full hover:bg-purple-100 transition-all duration-300 flex-1"> ë‹¤ì‹œ ë„ì „! ğŸš€ </button> <button onclick="closeModal(); goToMenu();" class="bg-purple-800 text-white font-bold py-3 px-6 rounded-full hover:bg-purple-900 transition-all duration-300 flex-1"> ë©”ë‰´ </button>
     </div>
    </div>
   </div>
  </div>
  <script>
    // Game state
    let cards = [];
    let flippedCards = [];
    let matchedPairs = 0;
    let moves = 0;
    let gameStarted = false;
    let timerInterval = null;
    let seconds = 0;
    let isLocked = false;
    let currentDifficulty = null;
    let timeLimit = 180;

    // Card emojis - 15 pairs
    const allEmojis = ['ğŸ¦Š', 'ğŸ¼', 'ğŸ¦', 'ğŸ¸', 'ğŸ¦‹', 'ğŸŒ¸', 'â­', 'ğŸŒˆ', 'ğŸ', 'ğŸˆ', 'ğŸ¸', 'ğŸ®', 'ğŸš€', 'ğŸ°', 'âš½'];

    // Difficulty settings
    const difficultySettings = {
      easy: {
        pairs: 8,
        cols: 4,
        rows: 4,
        timeLimit: 180,
        text: 'ğŸ˜Š ì‰¬ì›€'
      },
      normal: {
        pairs: 10,
        cols: 5,
        rows: 4,
        timeLimit: 180,
        text: 'ğŸ® ë³´í†µ'
      },
      hard: {
        pairs: 15,
        cols: 6,
        rows: 5,
        timeLimit: 180,
        text: 'ğŸ”¥ ì–´ë ¤ì›€'
      }
    };

    // Default config
    const defaultConfig = {
      game_title: 'ğŸ§  ë©”ëª¨ë¦¬ ê²Œì„',
      time_limit: '180'
    };

    // Initialize game
    function initGame() {
      const settings = difficultySettings[currentDifficulty];
      const emojisUsed = allEmojis.slice(0, settings.pairs);
      
      cards = [...emojisUsed, ...emojisUsed]
        .sort(() => Math.random() - 0.5)
        .map((emoji, index) => ({
          id: index,
          emoji: emoji,
          isFlipped: false,
          isMatched: false
        }));

      flippedCards = [];
      matchedPairs = 0;
      moves = 0;
      seconds = 0;
      gameStarted = false;
      isLocked = false;

      if (timerInterval) {
        clearInterval(timerInterval);
        timerInterval = null;
      }

      updateStats();
      renderBoard();
    }

    function renderBoard() {
      const board = document.getElementById('game-board');
      const settings = difficultySettings[currentDifficulty];
      board.innerHTML = '';
      board.style.width = 'auto';
      board.style.maxWidth = '90vw';

      cards.forEach((card, index) => {
        const cardElement = document.createElement('div');
        cardElement.className = 'card-container cursor-pointer';
        cardElement.style.width = '80px';
        cardElement.style.height = '80px';
        cardElement.innerHTML = `
          <div class="card w-full h-full ${card.isFlipped || card.isMatched ? 'flipped' : ''} ${card.isMatched ? 'matched' : ''}" data-index="${index}">
            <div class="card-face card-back"></div>
            <div class="card-face card-front">${card.emoji}</div>
          </div>
        `;
        cardElement.onclick = () => flipCard(index);
        board.appendChild(cardElement);
      });
    }

    function flipCard(index) {
      if (isLocked) return;
      if (cards[index].isFlipped || cards[index].isMatched) return;
      if (flippedCards.length >= 2) return;

      // Start timer on first flip
      if (!gameStarted) {
        gameStarted = true;
        startTimer();
      }

      cards[index].isFlipped = true;
      flippedCards.push(index);

      const cardElement = document.querySelector(`[data-index="${index}"]`);
      cardElement.classList.add('flipped');

      if (flippedCards.length === 2) {
        moves++;
        updateStats();
        checkMatch();
      }
    }

    function checkMatch() {
      const [first, second] = flippedCards;
      
      if (cards[first].emoji === cards[second].emoji) {
        // Match found!
        cards[first].isMatched = true;
        cards[second].isMatched = true;
        matchedPairs++;

        setTimeout(() => {
          const firstCard = document.querySelector(`[data-index="${first}"]`);
          const secondCard = document.querySelector(`[data-index="${second}"]`);
          firstCard.classList.add('matched');
          secondCard.classList.add('matched');
          
          flippedCards = [];
          updateStats();

          const settings = difficultySettings[currentDifficulty];
          if (matchedPairs === settings.pairs) {
            setTimeout(showWinModal, 600);
          }
        }, 300);

      } else {
        // No match
        isLocked = true;
        setTimeout(() => {
          cards[first].isFlipped = false;
          cards[second].isFlipped = false;

          const firstCard = document.querySelector(`[data-index="${first}"]`);
          const secondCard = document.querySelector(`[data-index="${second}"]`);
          firstCard.classList.remove('flipped');
          secondCard.classList.remove('flipped');

          flippedCards = [];
          isLocked = false;
        }, 1000);
      }
    }

    function startTimer() {
      timerInterval = setInterval(() => {
        seconds++;
        
        if (seconds >= timeLimit) {
          clearInterval(timerInterval);
          timerInterval = null;
          showGameOverModal();
          return;
        }
        
        updateStats();
      }, 1000);
    }

    function formatTime(totalSeconds) {
      const mins = Math.floor(totalSeconds / 60);
      const secs = totalSeconds % 60;
      return `${mins}:${secs.toString().padStart(2, '0')}`;
    }

    function getTimeRemaining() {
      const remaining = timeLimit - seconds;
      return remaining < 0 ? 0 : remaining;
    }

    function updateStats() {
      document.getElementById('moves').textContent = moves;
      document.getElementById('matches').textContent = matchedPairs;
      
      const remaining = getTimeRemaining();
      document.getElementById('timer').textContent = formatTime(remaining);
      
      // Change color when time is running out (less than 30 seconds)
      const timerContainer = document.getElementById('timer-container');
      if (remaining <= 30 && remaining > 0) {
        timerContainer.classList.add('time-warning');
      } else {
        timerContainer.classList.remove('time-warning');
      }
    }

    function showWinModal() {
      if (timerInterval) {
        clearInterval(timerInterval);
        timerInterval = null;
      }
      document.getElementById('modal-icon').textContent = 'ğŸ‰';
      document.getElementById('modal-title').textContent = 'ì¶•í•˜í•´ìš”!';
      document.getElementById('modal-desc').textContent = 'ëª¨ë“  ì¹´ë“œë¥¼ ì°¾ì•˜ì–´ìš”!';
      document.getElementById('final-moves').textContent = moves;
      document.getElementById('final-matches').textContent = matchedPairs;
      document.getElementById('game-over-modal').classList.remove('hidden');
    }

    function showGameOverModal() {
      document.getElementById('modal-icon').textContent = 'ğŸ˜¢';
      document.getElementById('modal-title').textContent = 'ì‹œê°„ ì´ˆê³¼!';
      document.getElementById('modal-desc').textContent = 'ì•„ì‰¬ì›Œìš”. ë‹¤ì‹œ ë„ì „í•´ ë³´ì„¸ìš”!';
      document.getElementById('final-moves').textContent = moves;
      document.getElementById('final-matches').textContent = matchedPairs;
      document.getElementById('game-over-modal').classList.remove('hidden');
    }

    function closeModal() {
      document.getElementById('game-over-modal').classList.add('hidden');
    }

    function startGame(difficulty) {
      currentDifficulty = difficulty;
      const settings = difficultySettings[difficulty];
      document.getElementById('difficulty-text').textContent = settings.text;
      
      // Parse time limit from config
      const timeLimitConfig = parseInt(window.elementSdk?.config?.time_limit || defaultConfig.time_limit);
      timeLimit = timeLimitConfig || 180;
      
      document.getElementById('main-menu').classList.add('hidden');
      document.getElementById('game-screen').classList.remove('hidden');
      
      initGame();
    }

    function restartGame() {
      closeModal();
      initGame();
    }

    function goToMenu() {
      if (timerInterval) {
        clearInterval(timerInterval);
        timerInterval = null;
      }
      document.getElementById('game-screen').classList.add('hidden');
      document.getElementById('main-menu').classList.remove('hidden');
      closeModal();
    }

    // Config change handler
    async function onConfigChange(config) {
      const title = config.game_title || defaultConfig.game_title;
      document.getElementById('game-title').textContent = title;
    }

    // Initialize SDK
    if (window.elementSdk) {
      window.elementSdk.init({
        defaultConfig: defaultConfig,
        onConfigChange: onConfigChange,
        mapToCapabilities: (config) => ({
          recolorables: [],
          borderables: [],
          fontEditable: undefined,
          fontSizeable: undefined
        }),
        mapToEditPanelValues: (config) => new Map([
          ['game_title', config.game_title || defaultConfig.game_title],
          ['time_limit', config.time_limit || defaultConfig.time_limit]
        ])
      });
    }

  </script>
 <script>(function(){function c(){var b=a.contentDocument||a.contentWindow.document;if(b){var d=b.createElement('script');d.innerHTML="window.__CF$cv$params={r:'9cd43261a19b32a2',t:'MTc3MDk4NDM1Ni4wMDAwMDA='};var a=document.createElement('script');a.nonce='';a.src='/cdn-cgi/challenge-platform/scripts/jsd/main.js';document.getElementsByTagName('head')[0].appendChild(a);";b.getElementsByTagName('head')[0].appendChild(d)}}if(document.body){var a=document.createElement('iframe');a.height=1;a.width=1;a.style.position='absolute';a.style.top=0;a.style.left=0;a.style.border='none';a.style.visibility='hidden';document.body.appendChild(a);if('loading'!==document.readyState)c();else if(window.addEventListener)document.addEventListener('DOMContentLoaded',c);else{var e=document.onreadystatechange||function(){};document.onreadystatechange=function(b){e(b);'loading'!==document.readyState&&(document.onreadystatechange=e,c())}}}})();</script></body>
</html>
